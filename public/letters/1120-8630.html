<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="11/20">
  <title>11/20 - Thank You Notes</title>
  <link rel="manifest" href="/letters/manifest.json">
  <meta name="theme-color" content="#007bff">
  <link rel="apple-touch-icon" href="/letters/icon-192.png">
  <style>
    /**
 * Shared Styles for Thank You Notes
 * Used by both the static site and PWA version
 */

/* Base Reset and Layout */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #f5f5f5;
  color: #333;
  line-height: 1.6;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

/* Loading and Error States */
.loading,
.error {
  text-align: center;
  padding: 3rem;
  font-size: 1.2rem;
}

.error {
  color: #dc3545;
}

/* Header */
.header {
  margin-bottom: 1.5rem;
  text-align: center;
}

.header h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
}

.subtitle {
  font-size: 1rem;
  color: #666;
}

/* Controls */
.controls {
  margin-bottom: 2rem;
}

.search-container {
  position: relative;
  margin-bottom: 1rem;
}

.search-input {
  width: 100%;
  padding: 0.75rem 2.5rem 0.75rem 1rem;
  font-size: 1rem;
  border: 2px solid #dee2e6;
  border-radius: 8px;
  outline: none;
  transition: border-color 0.2s;
  background: white;
}

.search-input:focus {
  border-color: #007bff;
}

.clear-search {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  font-size: 1.25rem;
  color: #6c757d;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  line-height: 1;
  transition: color 0.2s;
}

.clear-search:hover {
  color: #333;
}

.control-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.sort-container {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sort-container label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #666;
}

.sort-select {
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
  border: 2px solid #dee2e6;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  outline: none;
  transition: border-color 0.2s;
}

.sort-select:focus {
  border-color: #007bff;
}

.result-count {
  font-size: 0.875rem;
  font-weight: 600;
  color: #495057;
  padding: 0.5rem 0.75rem;
  background: #e9ecef;
  border-radius: 6px;
  white-space: nowrap;
}

.btn-random {
  background: #28a745;
  color: white;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  white-space: nowrap;
}

.btn-random:hover {
  background: #218838;
  transform: translateY(-1px);
}

.btn-random:active {
  transform: translateY(0);
}

.searching,
.no-results {
  text-align: center;
  padding: 3rem 1rem;
  font-size: 1.1rem;
  color: #666;
}

/* Email/Letter List */
.list,
.letter-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.email-card,
.letter-card {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  text-decoration: none;
  color: inherit;
  display: block;
}

.email-card:hover,
.letter-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.email-card-image {
  width: 100%;
  height: 200px;
  overflow: hidden;
  background: #e9ecef;
}

.email-card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.email-card-content,
.letter-card {
  padding: 1.5rem;
}

.email-card h2,
.letter-card h2 {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
  font-weight: 600;
}

.email-description,
.letter-card p {
  color: #666;
  margin-bottom: 0.75rem;
  line-height: 1.5;
}

.email-search-snippet {
  color: #555;
  margin-bottom: 0.75rem;
  line-height: 1.5;
  font-style: italic;
}

.search-highlight {
  background: #fff3cd;
  color: #856404;
  font-weight: 700;
  padding: 0.1rem 0.2rem;
  border-radius: 3px;
  font-style: normal;
}

.email-date,
.letter-card time {
  display: block;
  font-size: 0.875rem;
  color: #888;
}

/* Email/Letter Reader */
.email-reader,
.letter-content {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  margin-bottom: 2rem;
}

.email-reader {
  touch-action: pan-y pinch-zoom;
}

.reader-nav,
.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background: #f8f9fa;
  border-bottom: 1px solid #dee2e6;
  gap: 1rem;
  flex-wrap: wrap;
}

.reader-nav-bottom {
  border-top: 1px solid #dee2e6;
  border-bottom: none;
}

.nav-buttons,
.nav-links {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

/* Buttons */
.btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  text-decoration: none;
  display: inline-block;
}

.btn:hover {
  transform: translateY(-1px);
}

.btn:active {
  transform: translateY(0);
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-nav {
  background: #007bff;
  color: white;
}

.btn-nav:hover {
  background: #0056b3;
}

.btn-back-arrow {
  background: none;
  border: none;
  color: #333;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  transition: color 0.2s, transform 0.1s;
  line-height: 1;
}

.btn-back-arrow:hover {
  color: #007bff;
  transform: translateX(-2px);
}

.btn-back-arrow:active {
  transform: translateX(0);
}

/* Email/Letter Content */
.email-content,
.letter-content {
  padding: 2rem 1.5rem;
}

.email-header,
.letter-header {
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 2px solid #e9ecef;
}

.email-header h1,
.letter-header h1 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
  line-height: 1.3;
}

.email-header .email-date,
.letter-header time {
  font-size: 1rem;
  color: #666;
}

/* Email/Letter Body Styles */
.email-body,
.letter-body {
  font-size: 1.0625rem;
  line-height: 1.7;
  color: #333;
}

.email-body h1,
.email-body h2,
.email-body h3,
.email-body h4,
.email-body h5,
.email-body h6,
.letter-body h1,
.letter-body h2,
.letter-body h3,
.letter-body h4,
.letter-body h5,
.letter-body h6 {
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: #1a1a1a;
  line-height: 1.3;
}

.email-body h1,
.letter-body h1 {
  font-size: 1.875rem;
}

.email-body h2,
.letter-body h2 {
  font-size: 1.5rem;
}

.email-body h3,
.letter-body h3 {
  font-size: 1.25rem;
}

.email-body p,
.letter-body p {
  margin-bottom: 1rem;
}

.email-body a,
.letter-body a {
  color: #007bff;
  text-decoration: none;
}

.email-body a:hover,
.letter-body a:hover {
  text-decoration: underline;
}

.email-body img,
.letter-body img {
  max-width: 100%;
  height: auto;
  border-radius: 4px;
  margin: 1.5rem 0;
}

.email-body ul,
.email-body ol,
.letter-body ul,
.letter-body ol {
  margin-bottom: 1rem;
  padding-left: 2rem;
}

.email-body li,
.letter-body li {
  margin-bottom: 0.5rem;
}

.email-body blockquote,
.letter-body blockquote {
  margin: 1.5rem 0;
  padding-left: 1rem;
  border-left: 4px solid #e9ecef;
  color: #666;
  font-style: italic;
}

.email-body code,
.letter-body code {
  background: #f8f9fa;
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  font-family: 'Courier New', monospace;
  font-size: 0.9em;
}

.email-body pre,
.letter-body pre {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto;
  margin: 1.5rem 0;
}

.email-body pre code,
.letter-body pre code {
  background: none;
  padding: 0;
}

.email-body hr,
.letter-body hr {
  border: none;
  border-top: 2px solid #e9ecef;
  margin: 2rem 0;
}

/* PWA Banner */
.pwa-banner {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.pwa-banner-text {
  flex: 1;
  min-width: 200px;
}

.pwa-banner-text h3 {
  margin-bottom: 0.25rem;
  font-size: 1.1rem;
}

.pwa-banner-text p {
  font-size: 0.9rem;
  opacity: 0.9;
}

.btn-primary {
  background: #007bff;
  color: white;
  padding: 0.75rem 1.25rem;
  border: none;
  border-radius: 6px;
  font-size: 0.9375rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-primary:hover {
  background: #0056b3;
  transform: translateY(-1px);
}

.btn-primary:active {
  transform: translateY(0);
}

.btn-primary:disabled {
  background: #6c757d;
  cursor: not-allowed;
  transform: none;
}

.btn-danger {
  background: #dc3545;
  color: white;
  padding: 0.75rem 1.25rem;
  border: none;
  border-radius: 6px;
  font-size: 0.9375rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-danger:hover {
  background: #c82333;
  transform: translateY(-1px);
}

.btn-danger:active {
  transform: translateY(0);
}

/* Offline & PWA UI */
.offline-banner {
  background: #ff9800;
  color: white;
  padding: 0.75rem 1rem;
  text-align: center;
  border-radius: 8px;
  margin-bottom: 1rem;
  font-weight: 500;
}

.download-progress {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.download-progress-bar {
  height: 8px;
  background: #e9ecef;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.download-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #007bff, #0056b3);
  transition: width 0.3s ease;
}

.download-progress p {
  font-size: 0.875rem;
  color: #666;
  text-align: center;
  margin: 0;
}

.btn-offline {
  background: #6c757d;
  color: white;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  white-space: nowrap;
}

.btn-offline:hover {
  background: #5a6268;
  transform: translateY(-1px);
}

.btn-offline:active {
  transform: translateY(0);
}

.offline-panel {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.offline-panel h3 {
  margin-bottom: 1rem;
  color: #1a1a1a;
  font-size: 1.25rem;
}

.offline-stats {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 6px;
  margin-bottom: 1rem;
}

.offline-stats p {
  margin: 0.5rem 0;
  color: #495057;
  font-size: 0.9375rem;
}

.offline-actions {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.offline-note {
  font-size: 0.875rem;
  color: #666;
  line-height: 1.5;
  margin: 0;
  font-style: italic;
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    padding: 1rem 0.5rem;
  }

  .header h1 {
    font-size: 2rem;
  }

  .control-row {
    flex-direction: column;
    align-items: stretch;
  }

  .sort-container {
    width: 100%;
    justify-content: space-between;
  }

  .sort-select {
    flex: 1;
  }

  .result-count {
    text-align: center;
  }

  .btn-random {
    width: 100%;
  }

  .email-card-content {
    padding: 1rem;
  }

  .email-card h2 {
    font-size: 1.25rem;
  }

  .email-content,
  .letter-content {
    padding: 1.5rem 1rem;
  }

  .email-header h1,
  .letter-header h1 {
    font-size: 1.5rem;
  }

  .reader-nav,
  .navigation {
    flex-direction: column;
    align-items: stretch;
  }

  .nav-buttons,
  .nav-links {
    flex-direction: column;
  }

  .btn {
    width: 100%;
    text-align: center;
  }

  .btn-nav {
    font-size: 0.8125rem;
    white-space: normal;
    word-wrap: break-word;
  }

  body {
    padding: 10px;
  }

  .pwa-banner {
    flex-direction: column;
    text-align: center;
  }
}

@media (max-width: 480px) {
  .email-card-image {
    height: 150px;
  }

  .email-body,
  .letter-body {
    font-size: 1rem;
  }
}

    
    /* Static site specific adjustments */
    body {
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    
    <div class="pwa-banner" style="display: none;">
      <div class="pwa-banner-text">
        <h3>üì± Read Offline</h3>
        <p>Install the app to read all letters offline</p>
      </div>
      <div>
        <button class="btn btn-primary" onclick="installPWA()">Install App</button>
      </div>
    </div>

    <article class="letter-content">
      <header class="letter-header">
        <h1>11/20</h1>
        <time datetime="2016-11-20T00:00:00Z">November 19, 2016</time>
      </header>

      <div class="letter-body">
        <p>i&#39;m thankful that a few minutes ago, gmail ate the response i had almost completed writing to you. i&#39;m thankful for my annoyance at that. i&#39;m thankful for <a href="https://productforums.google.com/forum/#!topic/gmail/4SqKobkWCKw">this thread of grumpy people</a>. i&#39;m thankful that i have the time to try to rewrite what i already wrote. i&#39;m thankful to be frustrated to have lost what felt like the &quot;right&#39; phrasing but am also thankful to be forced to accept imperfection. i&#39;m thankful for the concept of a <a href="http://tvtropes.org/pmwiki/pmwiki.php/Main/RacingGhost">ghost run</a> in a racing game and am thankful that i feel like i&#39;m doing a ghost run of my disappeared email draft. i&#39;m thankful to think of it that way, which makes this feel like a challenge, like a time trial instead of just a trial.</p>
<p>i&#39;m thankful that i cleaned out our cupboards yesterday, even though it took most of the afternoon. i&#39;m thankful to have gotten rid of stale and expired food, to have broken down empty cardboard boxes, to have discarded stray plastic wrappers. i&#39;m thankful for the satisfaction of condensing multiple partial containers of a kind of food into a single container. i&#39;m thankful for the alien roots growing up out of a forgotten yam. i&#39;m thankful for the food i forgot about because it was buried in the cupboards (several kinds of nice tea, the dried squid jk brought us from korea, a very large amount of seaweed and rice noodles), i&#39;m thankful that the space i cleared in the cupboards allowed me to create space on the counters, which makes the kitchen feel bigger and cleaner. i&#39;m thankful for clear surfaces.</p>
<p>i&#39;m thankful for the chili cheese dogs and roasted okra i made us for dinner last night and for the leftover gelato we had for dessert. i&#39;m thankful for <em>luther</em>, which d and i are watching and which is pretty good so far. i&#39;m thankful that i don&#39;t normally like episodic procedurals (and am thankful that d doesn&#39;t either) but that so far this one has been able to hold my attention. i&#39;m thankful to suppose that part of this is due to the cleverness of the plot contrivances and partly due to the performances. i&#39;m thankful for ruth wilson&#39;s campy (but not too campy) evil grinch grin and for the pleasing sound of her voice. i&#39;m thankful for <a href="https://www.youtube.com/watch?v=DVUYnZbyoCg">idris elba&#39;s music video for his song &quot;private garden.</a>&quot;</p>
<p>i&#39;m thankful for <a href="http://www.glixel.com/interviews/amy-hennig-on-taking-star-wars-somewhere-new-w450064">this interview with amy hennig</a>, the director behind the <em>uncharted</em> series. i&#39;m thankful that the commitment she describes to trying to capture performances that feel human comes across in the games that she&#39;s made. i&#39;m thankful for her rejection of a formalist theory of games, that she believes narrative and character are important, but that at the same time she understands &quot;<em>if the player feels they&#39;re being shoved through a greased chute then we&#39;re not doing our job</em>.&quot; i&#39;m thankful for <a href="https://www.idlethumbs.net/designernotes/episodes/amy-hennig">this podcast interview</a> with her, which i will probably listen to later.</p>
<p>i&#39;m thankful for <a href="http://mobile.nytimes.com/2016/10/17/t-magazine/michelle-obama-chimamanda-ngozi-adichie-gloria-steinem-letter.html?smid=tw-share&_r=0&referer=">these thank you notes for michelle obama</a>. i&#39;m thankful for michelle obama and for president obama. i&#39;m thankful for maybe the thing i like most about both of them (i&#39;m thankful there are many things), which is that it seems like neither of them really enjoys the trappings of power, that i think they both feel it actually makes their lives worse, less happy and full and rich, but that they accepted it and worked to acquire it because they believed the good they could do from the place was worth the unpleasantness they would suffer. i&#39;m thankful for their sacrifices. i&#39;m thankful that my coworker from peru got to see president obama speak there yesterday and am thankful for the excited DMs she and I exchanged about it. i&#39;m thankful how her camera phone pictures showed that she was so close to him and am thankful for his smile in one of the pics.</p>
<p>i&#39;m thankful for phillip larkin&#39;s &quot;the old fools,&quot; which was in today&#39;s alipore post. i&#39;m thankful always to read larkin on oblivion, on being and nothingness, but am also thankful for the occasional sugar stirred into his bitter black tea.</p>
<p><em>At death you break up: the bits that were you</em></p>
<p><em>Start speeding away from each other for ever</em></p>
<p><em>With no one to see. It‚Äôs only oblivion, true:</em></p>
<p><em>We had it before, but then it was going to end,</em></p>
<p><em>And was all the time merging with a unique endeavour</em></p>
<p><em>To bring to bloom the million-petalled flower</em></p>
<p><em>Of being here. Next time you can‚Äôt pretend</em></p>
<p><em>There‚Äôll be anything else. And these are the first signs:</em></p>
<p><em>Not knowing how, not hearing who, the power</em></p>
<p><em>Of choosing gone. Their looks show that they‚Äôre for it:</em></p>
<p><em>Ash hair, toad hands, prune face dried into lines -</em></p>
<p><em>How can they ignore it?</em></p>
<p><em>Perhaps being old is having lighted rooms</em></p>
<p><em>Inside you head, and people in them, acting</em></p>
<p><em>People you know, yet can‚Äôt quite name; each looms</em></p>
<p><em>Like a deep loss restored, from known doors turning,</em></p>
<p><em>Setting down a lamp, smiling from a stair, extracting</em></p>
<p><em>A known book from the shelves; or sometimes only</em></p>
<p><em>The rooms themselves, chairs and a fire burning,</em></p>
<p><em>The blown bush at the window, or the sun‚Äôs</em></p>
<p><em>Faint friendliness on the wall some lonely</em></p>
<p><em>Rain-ceased midsummer evening. That is where they live:</em></p>
<p><em>Not here and now, but where all happened once.</em></p>
<p><em>This is why they give</em></p>
<p>i&#39;m thankful for the whole poem, which you can <a href="http://tinyletter.com/thealiporepost/letters/656">read here</a>. i&#39;m thankful for these two stanzas from &quot;<a href="https://www.poetryfoundation.org/poems-and-poets/poems/detail/48422">aubade</a>,&quot; which feature a similar shift in imagery from dark to light, death not forgotten or left but lived with, another layer in the palimpsest of the day.</p>
<p>&quot;<em>And so it stays just on the edge of vision,</em> ¬†¬†</p>
<p><em>A small unfocused blur, a standing chill</em> ¬†¬†</p>
<p><em>That slows each impulse down to indecision.</em> ¬†¬†</p>
<p><em>Most things may never happen: this one will,</em> ¬†¬†</p>
<p><em>And realisation of it rages out</em></p>
<p><em>In furnace-fear when we are caught without</em> ¬†¬†</p>
<p><em>People or drink. Courage is no good:</em></p>
<p><em>It means not scaring others. Being brave</em> ¬†¬†</p>
<p><em>Lets no one off the grave.</em></p>
<p><em>Death is no different whined at than withstood.</em></p>
<p><em>Slowly light strengthens, and the room takes shape.</em> ¬†¬†</p>
<p><em>It stands plain as a wardrobe, what we know,</em> ¬†¬†</p>
<p><em>Have always known, know that we can‚Äôt escape,</em> ¬†¬†</p>
<p><em>Yet can‚Äôt accept. One side will have to go.</em></p>
<p><em>Meanwhile telephones crouch, getting ready to ring</em> ¬†¬†</p>
<p><em>In locked-up offices, and all the uncaring</em></p>
<p><em>Intricate rented world begins to rouse.</em></p>
<p><em>The sky is white as clay, with no sun.</em></p>
<p><em>Work has to be done.</em></p>
<p><em>Postmen like doctors go from house to house.</em>&quot;</p>
<p>i&#39;m thankful for the delivery of messages, physical and virtual. i&#39;m thankful for the red leaf i saw on the ground under the car at the grocery store yesterday. i&#39;m thankful for the robin i spied in profile while washing dishes, sitting on the neighbor&#39;s fence in the dark. i&#39;m thankful to be able to get up and make a cup of tea.</p>

      </div>
    </article>

    <nav class="navigation">
      <a href="/letters/" class="btn btn-secondary">home</a>
      <div class="nav-links">
        <a href="/letters/letters/1121-9363.html" class="btn btn-secondary">‚Üê 11/21</a>
        <a href="/letters/letters/patrick3.html" class="btn btn-secondary">patrick(3) ‚Üí</a>
      </div>
    </nav>
  
  </div>

  <script>
    // PWA installation prompt
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      const banner = document.querySelector('.pwa-banner');
      if (banner) {
        banner.style.display = 'flex';
      }
    });

    async function installPWA() {
      if (!deferredPrompt) {
        // If not installable, redirect to PWA
        window.location.href = '/letters/app/';
        return;
      }

      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        console.log('PWA installed');
      }
      
      deferredPrompt = null;
      const banner = document.querySelector('.pwa-banner');
      if (banner) {
        banner.style.display = 'none';
      }
    }

    function openPWA() {
      window.location.href = '/letters/app/';
    }

    // Progressive Enhancement: Check if user has PWA installed
    // If they do, redirect them to the app version for a richer experience
    if (window.matchMedia('(display-mode: standalone)').matches) {
      // User is in standalone mode (PWA is installed and running)
      // Keep them on static page - they're already in PWA mode
      console.log('Running in PWA mode');
    } else {
      // Check if user has previously used the PWA (has cached data)
      if ('caches' in window) {
        caches.keys().then(cacheNames => {
          const hasPWACache = cacheNames.some(name => 
            name.includes('static-') || name.includes('data-')
          );
          
          // Only show PWA banner if they have cached content
          if (hasPWACache) {
            const banner = document.querySelector('.pwa-banner');
            if (banner && banner.style.display === 'none') {
              banner.style.display = 'flex';
            }
          }
        });
      }
    }

    // Register service worker for all pages
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('/letters/sw.js', { scope: '/letters/' })
          .then((registration) => {
            console.log('SW registered:', registration);
          })
          .catch((error) => {
            console.log('SW registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>