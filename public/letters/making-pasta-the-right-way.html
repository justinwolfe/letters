<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="making pasta the right way">
  <title>making pasta the right way - Thank You Notes</title>
  <link rel="manifest" href="/letters/manifest.json">
  <meta name="theme-color" content="#007bff">
  <link rel="apple-touch-icon" href="/letters/icon-192.png">
  <style>
    /**
 * Shared Styles for Thank You Notes
 * Used by both the static site and PWA version
 */

/* Base Reset and Layout */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #f5f5f5;
  color: #333;
  line-height: 1.6;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

/* Loading and Error States */
.loading,
.error {
  text-align: center;
  padding: 3rem;
  font-size: 1.2rem;
}

.error {
  color: #dc3545;
}

/* Header */
.header {
  margin-bottom: 1.5rem;
  text-align: center;
}

.header h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
}

.subtitle {
  font-size: 1rem;
  color: #666;
}

/* Controls */
.controls {
  margin-bottom: 2rem;
}

.search-container {
  position: relative;
  margin-bottom: 1rem;
}

.search-input {
  width: 100%;
  padding: 0.75rem 2.5rem 0.75rem 1rem;
  font-size: 1rem;
  border: 2px solid #dee2e6;
  border-radius: 8px;
  outline: none;
  transition: border-color 0.2s;
  background: white;
}

.search-input:focus {
  border-color: #007bff;
}

.clear-search {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  font-size: 1.25rem;
  color: #6c757d;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  line-height: 1;
  transition: color 0.2s;
}

.clear-search:hover {
  color: #333;
}

.control-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.sort-container {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sort-container label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #666;
}

.sort-select {
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
  border: 2px solid #dee2e6;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  outline: none;
  transition: border-color 0.2s;
}

.sort-select:focus {
  border-color: #007bff;
}

.result-count {
  font-size: 0.875rem;
  font-weight: 600;
  color: #495057;
  padding: 0.5rem 0.75rem;
  background: #e9ecef;
  border-radius: 6px;
  white-space: nowrap;
}

.btn-random {
  background: #28a745;
  color: white;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  white-space: nowrap;
}

.btn-random:hover {
  background: #218838;
  transform: translateY(-1px);
}

.btn-random:active {
  transform: translateY(0);
}

.searching,
.no-results {
  text-align: center;
  padding: 3rem 1rem;
  font-size: 1.1rem;
  color: #666;
}

/* Email/Letter List */
.list,
.letter-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.email-card,
.letter-card {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  text-decoration: none;
  color: inherit;
  display: block;
}

.email-card:hover,
.letter-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.email-card-image {
  width: 100%;
  height: 200px;
  overflow: hidden;
  background: #e9ecef;
}

.email-card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.email-card-content,
.letter-card {
  padding: 1.5rem;
}

.email-card h2,
.letter-card h2 {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
  font-weight: 600;
}

.email-description,
.letter-card p {
  color: #666;
  margin-bottom: 0.75rem;
  line-height: 1.5;
}

.email-search-snippet {
  color: #555;
  margin-bottom: 0.75rem;
  line-height: 1.5;
  font-style: italic;
}

.search-highlight {
  background: #fff3cd;
  color: #856404;
  font-weight: 700;
  padding: 0.1rem 0.2rem;
  border-radius: 3px;
  font-style: normal;
}

.email-date,
.letter-card time {
  display: block;
  font-size: 0.875rem;
  color: #888;
}

/* Email/Letter Reader */
.email-reader,
.letter-content {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  margin-bottom: 2rem;
}

.email-reader {
  touch-action: pan-y pinch-zoom;
}

.reader-nav,
.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background: #f8f9fa;
  border-bottom: 1px solid #dee2e6;
  gap: 1rem;
  flex-wrap: wrap;
}

.reader-nav-bottom {
  border-top: 1px solid #dee2e6;
  border-bottom: none;
}

.nav-buttons,
.nav-links {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

/* Buttons */
.btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  text-decoration: none;
  display: inline-block;
}

.btn:hover {
  transform: translateY(-1px);
}

.btn:active {
  transform: translateY(0);
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-nav {
  background: #007bff;
  color: white;
}

.btn-nav:hover {
  background: #0056b3;
}

.btn-back-arrow {
  background: none;
  border: none;
  color: #333;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  transition: color 0.2s, transform 0.1s;
  line-height: 1;
}

.btn-back-arrow:hover {
  color: #007bff;
  transform: translateX(-2px);
}

.btn-back-arrow:active {
  transform: translateX(0);
}

/* Email/Letter Content */
.email-content,
.letter-content {
  padding: 2rem 1.5rem;
}

.email-header,
.letter-header {
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 2px solid #e9ecef;
}

.email-header h1,
.letter-header h1 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
  line-height: 1.3;
}

.email-header .email-date,
.letter-header time {
  font-size: 1rem;
  color: #666;
}

/* Email/Letter Body Styles */
.email-body,
.letter-body {
  font-size: 1.0625rem;
  line-height: 1.7;
  color: #333;
}

.email-body h1,
.email-body h2,
.email-body h3,
.email-body h4,
.email-body h5,
.email-body h6,
.letter-body h1,
.letter-body h2,
.letter-body h3,
.letter-body h4,
.letter-body h5,
.letter-body h6 {
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: #1a1a1a;
  line-height: 1.3;
}

.email-body h1,
.letter-body h1 {
  font-size: 1.875rem;
}

.email-body h2,
.letter-body h2 {
  font-size: 1.5rem;
}

.email-body h3,
.letter-body h3 {
  font-size: 1.25rem;
}

.email-body p,
.letter-body p {
  margin-bottom: 1rem;
}

.email-body a,
.letter-body a {
  color: #007bff;
  text-decoration: none;
}

.email-body a:hover,
.letter-body a:hover {
  text-decoration: underline;
}

.email-body img,
.letter-body img {
  max-width: 100%;
  height: auto;
  border-radius: 4px;
  margin: 1.5rem 0;
}

.email-body ul,
.email-body ol,
.letter-body ul,
.letter-body ol {
  margin-bottom: 1rem;
  padding-left: 2rem;
}

.email-body li,
.letter-body li {
  margin-bottom: 0.5rem;
}

.email-body blockquote,
.letter-body blockquote {
  margin: 1.5rem 0;
  padding-left: 1rem;
  border-left: 4px solid #e9ecef;
  color: #666;
  font-style: italic;
}

.email-body code,
.letter-body code {
  background: #f8f9fa;
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  font-family: 'Courier New', monospace;
  font-size: 0.9em;
}

.email-body pre,
.letter-body pre {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto;
  margin: 1.5rem 0;
}

.email-body pre code,
.letter-body pre code {
  background: none;
  padding: 0;
}

.email-body hr,
.letter-body hr {
  border: none;
  border-top: 2px solid #e9ecef;
  margin: 2rem 0;
}

/* Email Tags */
.email-tags {
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 2px solid #e9ecef;
}

.tags-label {
  font-size: 0.875rem;
  font-weight: 600;
  color: #666;
  margin-bottom: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.tags-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.tag-badge {
  background: #e7f3ff;
  color: #0366d6;
  border: 1px solid #c8e1ff;
  padding: 0.375rem 0.75rem;
  border-radius: 16px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-block;
}

.tag-badge:hover {
  background: #0366d6;
  color: white;
  border-color: #0366d6;
  transform: translateY(-1px);
}

.tag-badge:active {
  transform: translateY(0);
}

.tag-title {
  font-size: 1.75rem;
  color: #0366d6;
  margin: 0.5rem 0;
  font-weight: 600;
}

.back-link {
  background: none;
  border: none;
  color: #007bff;
  font-size: 1rem;
  cursor: pointer;
  padding: 0;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s, transform 0.1s;
  display: inline-block;
}

.back-link:hover {
  color: #0056b3;
  text-decoration: underline;
  transform: translateX(-2px);
}

.back-link:active {
  transform: translateX(0);
}

/* PWA Banner */
.pwa-banner {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.pwa-banner-text {
  flex: 1;
  min-width: 200px;
}

.pwa-banner-text h3 {
  margin-bottom: 0.25rem;
  font-size: 1.1rem;
}

.pwa-banner-text p {
  font-size: 0.9rem;
  opacity: 0.9;
}

.btn-primary {
  background: #007bff;
  color: white;
  padding: 0.75rem 1.25rem;
  border: none;
  border-radius: 6px;
  font-size: 0.9375rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-primary:hover {
  background: #0056b3;
  transform: translateY(-1px);
}

.btn-primary:active {
  transform: translateY(0);
}

.btn-primary:disabled {
  background: #6c757d;
  cursor: not-allowed;
  transform: none;
}

.btn-danger {
  background: #dc3545;
  color: white;
  padding: 0.75rem 1.25rem;
  border: none;
  border-radius: 6px;
  font-size: 0.9375rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-danger:hover {
  background: #c82333;
  transform: translateY(-1px);
}

.btn-danger:active {
  transform: translateY(0);
}

/* Offline & PWA UI */
.offline-banner {
  background: #ff9800;
  color: white;
  padding: 0.75rem 1rem;
  text-align: center;
  border-radius: 8px;
  margin-bottom: 1rem;
  font-weight: 500;
}

.download-progress {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.download-progress-bar {
  height: 8px;
  background: #e9ecef;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.download-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #007bff, #0056b3);
  transition: width 0.3s ease;
}

.download-progress p {
  font-size: 0.875rem;
  color: #666;
  text-align: center;
  margin: 0;
}

.btn-offline {
  background: #6c757d;
  color: white;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  white-space: nowrap;
}

.btn-offline:hover {
  background: #5a6268;
  transform: translateY(-1px);
}

.btn-offline:active {
  transform: translateY(0);
}

.offline-panel {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.offline-panel h3 {
  margin-bottom: 1rem;
  color: #1a1a1a;
  font-size: 1.25rem;
}

.offline-stats {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 6px;
  margin-bottom: 1rem;
}

.offline-stats p {
  margin: 0.5rem 0;
  color: #495057;
  font-size: 0.9375rem;
}

.offline-actions {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.offline-note {
  font-size: 0.875rem;
  color: #666;
  line-height: 1.5;
  margin: 0;
  font-style: italic;
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    padding: 1rem 0.5rem;
  }

  .header h1 {
    font-size: 2rem;
  }

  .control-row {
    flex-direction: column;
    align-items: stretch;
  }

  .sort-container {
    width: 100%;
    justify-content: space-between;
  }

  .sort-select {
    flex: 1;
  }

  .result-count {
    text-align: center;
  }

  .btn-random {
    width: 100%;
  }

  .email-card-content {
    padding: 1rem;
  }

  .email-card h2 {
    font-size: 1.25rem;
  }

  .email-content,
  .letter-content {
    padding: 1.5rem 1rem;
  }

  .email-header h1,
  .letter-header h1 {
    font-size: 1.5rem;
  }

  .reader-nav,
  .navigation {
    flex-direction: column;
    align-items: stretch;
  }

  .nav-buttons,
  .nav-links {
    flex-direction: column;
  }

  .btn {
    width: 100%;
    text-align: center;
  }

  .btn-nav {
    font-size: 0.8125rem;
    white-space: normal;
    word-wrap: break-word;
  }

  body {
    padding: 10px;
  }

  .pwa-banner {
    flex-direction: column;
    text-align: center;
  }
}

@media (max-width: 480px) {
  .email-card-image {
    height: 150px;
  }

  .email-body,
  .letter-body {
    font-size: 1rem;
  }
}

    
    /* Static site specific adjustments */
    body {
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    
    <div class="pwa-banner" style="display: none;">
      <div class="pwa-banner-text">
        <h3>📱 Read Offline</h3>
        <p>Install the app to read all letters offline</p>
      </div>
      <div>
        <button class="btn btn-primary" onclick="installPWA()">Install App</button>
      </div>
    </div>

    <article class="letter-content">
      <header class="letter-header">
        <h1>making pasta the right way</h1>
        <time datetime="2024-03-08T16:29:00.569666Z">March 8, 2024</time>
      </header>

      <div class="letter-body">
        <p>my previous job is having their company retreat and because of watching on instagram i had a dream about it and as someone who has worked fully remotely for many years at this point, whenever i have work dreams they&#39;re about company retreats (since, despite how much of every waking hour i spend on a computer, my dreams rarely if ever involve directly using computers? my dream director is like &quot;not cinematic enough&quot;), dreams usually based around the idea that i have somehow despite great care forgotten the weed that i was bringing to the retreat to (among other things, including spreading cheer and deepening bonds) help me deal with the social overwhelm of being around ten million people after sitting alone in my office for the past year (and also just because i love weed), and this dream was kind of similar except i didn&#39;t forget the weed (or rather i did forget it but the dream retreat was taking place in a location where i could easily buy more) but i did break my phone (thankful that in the dream i still had my old android phone and could easily swap it out) and miss a flight and then the eventual hotel was, as is often the case in these dreams, bizarre and labyrinthian and endless and made it impossible to find my friends (i was thankful to wake up, and i&#39;m thankful that i&#39;ve been waking up earlier as the sun rises earlier and coincidentally having more time to write notes before work, even if i&#39;m not thankful we&#39;ll lose an hour of this weekend we need all the hours we can get).</p>
<p> <img src="/letters/images/342.jpg" alt="image.png"> </p>
<p>in the real world yesterday, being briefly baffled (and by baffled i mean panicked and desperate) by why the app i was building (was supposed to be done building and was just getting adding a small finishing refactoring touch suggested by a reviewer) was suddenly mysteriously distressingly not working despite no changes to the code since when it had been working and finally through a process of deduction getting to the realization that when testing someone else&#39;s PR the day before i had added overrides in the Network tab of Chrome blocking access to an API endpoint and (because it is very easy to forget about them based on how they structure their devtools UI, which is flawed in so many ways despite being such a useful suite of tools) had forgotten about them and that was what was breaking everything.</p>
<p> <img src="/letters/images/345.jpg" alt="image.png"> </p>
<p>the ridiculous news of biden&#39;s floating pier off gaza, which as an engineer is like such a pitch-fucking-perfect example of when you are coding an awkward and inefficient workaround around the problem out of an &quot;inability&quot; to solve the core problem (which i acknowledge is sometimes in engineering just what you have to do because of external constraints and dependencies but sometimes and fucking definitely in this case (okay already realizing this analogy is strained but i&#39;m so mad about this) represents a lack of fortitude and resolve, a conscious choice to &quot;solve&quot; a problem not by you know solving the problem but by putting glue and tape around the problem)(i have done both things as i&#39;d assume many engineers have, but again limits of the analogy, when i do it the bad way people don&#39;t die they just might in some cases have slightly more difficulty sending a customer support email response, which imo i can live with!)</p>
<p> <img src="/letters/images/341.jpg" alt="image.png"> </p>
<p>the eternal back-and-forth i find myself having both internally with myself and with my colleagues about doing things &quot;the right way&quot; with code, which as someone who started in an engineering background where i was mostly working alone and shipping tangible value as fast and as frequently as possible (which gets referred to as &quot;cowboy coding&quot; yeehaw) means i am often in tension with what i might term &quot;institutionalist&quot; engineers who (to paint with a very broad brush) are more focused on the code itself (finding the exact perfect abstractions, covering every possible case) than what the code will make it possible for the users (who will never ever see the code) to do and feel and think. i&#39;m thankful to acknowledge that there is a spectrum and everyone regardless of where they are on it (and people often move along it depending on their constraints for a particular project or who they&#39;re working with) is always making compromises toward the other end in an endless and often (if not always) productive negotiation, even if i sometimes uncharitably (but, imo, not always unfairly) think the pursuit of perfection underlying such an approach can be more about ego and obsessive compulsion and irrational fear of the worst possible hypothetical future than it is about true safety and protection and care (but that&#39;s just my perspective).</p>
<p> <img src="/letters/images/344.jpg" alt="image.png"> </p>
<p>deborah and i made a nice pasta (anchovies, bacon, garlic, broccoli, shitake mushrooms) last night and thinking about the right way made me think about how though i have been making pasta since i learned how to cook, up until a nudge from hp this year, i never really made it the right way, which is to say finishing the slightly al dente pasta in the same pan tossed with the sauce and some pasta water to bring everything together. i always avoided this step because that was not how i was taught and i thought doing it was not worth the hit to my cooking efficiency (as someone who was often bulk cooking both pasta and sauce for many meals and didn&#39;t want to combine them all at the initial point of cooking because sogginess but also didn&#39;t want to dirty additional pans to wash) but like it&#39;s absolutely worth it in terms of how it makes the pasta stick to the sauce and thus be more delicious (what i do now to reduce dishes is still cook my big cauldron of sauce but cook just enough pasta for a particular night&#39;s portions and then add the sauce and water to that pot after i&#39;ve drained it) and i can&#39;t imagine doing it otherwise now—i&#39;m thankful, as someone who doesn&#39;t always choose the right way, when i concretely feel the benefit of the right way, which is the best way to get me to do things the right way (again, to be clear, please avoid drawing a direct comparison between this personal low-stakes kind of rightness and the moral rightness of stopping a genocide which are extremely different things but thoughts of one thing inspired me to consider the other and what are these notes except traces of the footsteps of my thoughts).</p>
<p><img src="/letters/images/343.jpg" alt="image.png"> </p>
<p>had several difficult conversations at work yesterday and the general vibes are grim but hopefully there will be no difficult conversations at work today (i&#39;m thankful it is no meeting friday). i&#39;m thankful for <a href="https://capitulatenow.substack.com/p/capitulate-now-issue-67">this incredibly sad and beautiful letter from katie</a> about difficult conversations and parenting dread and, somehow, amid all the problems, (blessedly, thankfully) gratitude (sorry) and grace. i&#39;m thankful for the &quot;close tabs to the right&quot; option in chrome and all self-respecting modern browsers, an essential feature. i&#39;m thankful, once again, that it is friday and it&#39;s cold and gray now but i looked at the ten day forecast and next saturday, it&#39;s supposed to be sunny and 67 F/19.4 C, the warmest day of the year so far.</p>
<h2>Previously on this day:</h2>
<ul>
<li><a href="https://buttondown.email/justinwolfe/archive/thank-you-notes-38/">2016</a> (<em>targeted ads, kylie jenner&#39;s snapchat, three essays by emily witt</em>)</li>
<li><a href="https://buttondown.email/justinwolfe/archive/3817/">2017</a> (<em>too many amazing women to ever fit in a letter</em>)</li>
<li><a href="https://buttondown.email/justinwolfe/archive/3818/">2018</a> (<em>great conversations with smart people on my team, my favorite pharmacist, essay about sweatpants</em>)</li>
<li><a href="https://buttondown.email/justinwolfe/archive/37/">2019</a> (<em>&quot;to have taken d a polaroid of miso&quot;</em>)</li>
<li><a href="https://buttondown.email/justinwolfe/archive/3820/">2020</a> (<em>kumquats, figuring out the reason torrents stopped working on my old computer, parallel lives</em>)</li>
<li><a href="https://buttondown.email/justinwolfe/archive/how-thankful-i-was-to-be-rained-on-while-out/">2021</a> (<em>to be rained on while out running yesterday afternoon</em>)</li>
</ul>

      </div>

      
    <footer class="email-tags">
      <div class="tags-label">Tags:</div>
      <div class="tags-list">
        <a href="/letters/?tag=cooking-techniques" class="tag-badge">#cooking techniques</a>
        <a href="/letters/?tag=engineering-ethics" class="tag-badge">#engineering ethics</a>
        <a href="/letters/?tag=personal-reflections" class="tag-badge">#personal reflections</a>
        <a href="/letters/?tag=remote-work" class="tag-badge">#remote work</a>
        <a href="/letters/?tag=software-development" class="tag-badge">#software development</a>
        <a href="/letters/?tag=work-life-balance" class="tag-badge">#work-life balance</a>
      </div>
    </footer>
  
    </article>

    <nav class="navigation">
      <a href="/letters/" class="btn btn-secondary">home</a>
      <div class="nav-links">
        <a href="/letters/letters/a-book-i-could-not-tear-myself-away-from.html" class="btn btn-secondary">← a book i could not tear myself away from</a>
        <a href="/letters/letters/my-plot-memory-fades-very-quickly.html" class="btn btn-secondary">my plot memory fades very quickly →</a>
      </div>
    </nav>
  
  </div>

  <script>
    // PWA installation prompt
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      const banner = document.querySelector('.pwa-banner');
      if (banner) {
        banner.style.display = 'flex';
      }
    });

    async function installPWA() {
      if (!deferredPrompt) {
        // If not installable, redirect to PWA
        window.location.href = '/letters/app/';
        return;
      }

      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        console.log('PWA installed');
      }
      
      deferredPrompt = null;
      const banner = document.querySelector('.pwa-banner');
      if (banner) {
        banner.style.display = 'none';
      }
    }

    function openPWA() {
      // Mark PWA preference and redirect
      localStorage.setItem('pwa-preferred', 'true');

      // Extract the letter slug from current URL if on a letter page
      const path = window.location.pathname;
      const match = path.match(//letters/([^/]+).html$/);

      if (match) {
        const slug = match[1];
        window.location.href = '/letters/app/?letter=' + encodeURIComponent(slug);
      } else {
        window.location.href = '/letters/app/';
      }
    }

    // PWA Auto-redirect: Check if user prefers PWA or has ?pwa=1 parameter
    (function() {
      const params = new URLSearchParams(window.location.search);
      const preferPWA = params.get('pwa') === '1';
      const hasPWAPreference = localStorage.getItem('pwa-preferred') === 'true';

      // Don't redirect if already in standalone mode (PWA is installed and running)
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

      if ((preferPWA || hasPWAPreference) && !isStandalone) {
        // Redirect to PWA with letter context
        const path = window.location.pathname;
        const match = path.match(//letters/([^/]+).html$/);

        if (match) {
          const slug = match[1];
          window.location.href = '/letters/app/?letter=' + encodeURIComponent(slug);
        } else {
          window.location.href = '/letters/app/';
        }
        return; // Stop further execution
      }
    })();

    // Progressive Enhancement: Check if user has PWA installed
    // If they do, show banner suggesting to use the app
    if (window.matchMedia('(display-mode: standalone)').matches) {
      // User is in standalone mode (PWA is installed and running)
      // Keep them on static page - they're already in PWA mode
      console.log('Running in PWA mode');
    } else {
      // Check if user has previously used the PWA (has cached data)
      if ('caches' in window) {
        caches.keys().then(cacheNames => {
          const hasPWACache = cacheNames.some(name =>
            name.includes('static-') || name.includes('data-')
          );

          // Only show PWA banner if they have cached content
          if (hasPWACache) {
            const banner = document.querySelector('.pwa-banner');
            if (banner && banner.style.display === 'none') {
              banner.style.display = 'flex';
            }
          }
        });
      }
    }

    // Register service worker for all pages
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('/letters/sw.js', { scope: '/letters/' })
          .then((registration) => {
            console.log('SW registered:', registration);
          })
          .catch((error) => {
            console.log('SW registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>