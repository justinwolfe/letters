<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="5/24/17">
  <title>5/24/17 - Thank You Notes</title>
  <link rel="manifest" href="/letters/manifest.json">
  <meta name="theme-color" content="#007bff">
  <link rel="apple-touch-icon" href="/letters/icon-192.png">
  <style>
    /**
 * Shared Styles for Thank You Notes
 * Used by both the static site and PWA version
 */

/* Base Reset and Layout */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #f5f5f5;
  color: #333;
  line-height: 1.6;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

/* Loading and Error States */
.loading,
.error {
  text-align: center;
  padding: 3rem;
  font-size: 1.2rem;
}

.error {
  color: #dc3545;
}

/* Header */
.header {
  margin-bottom: 1.5rem;
  text-align: center;
}

.header h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
}

.subtitle {
  font-size: 1rem;
  color: #666;
}

/* Controls */
.controls {
  margin-bottom: 2rem;
}

.search-container {
  position: relative;
  margin-bottom: 1rem;
}

.search-input {
  width: 100%;
  padding: 0.75rem 2.5rem 0.75rem 1rem;
  font-size: 1rem;
  border: 2px solid #dee2e6;
  border-radius: 8px;
  outline: none;
  transition: border-color 0.2s;
  background: white;
}

.search-input:focus {
  border-color: #007bff;
}

.clear-search {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  font-size: 1.25rem;
  color: #6c757d;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  line-height: 1;
  transition: color 0.2s;
}

.clear-search:hover {
  color: #333;
}

.control-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.sort-container {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sort-container label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #666;
}

.sort-select {
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
  border: 2px solid #dee2e6;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  outline: none;
  transition: border-color 0.2s;
}

.sort-select:focus {
  border-color: #007bff;
}

.result-count {
  font-size: 0.875rem;
  font-weight: 600;
  color: #495057;
  padding: 0.5rem 0.75rem;
  background: #e9ecef;
  border-radius: 6px;
  white-space: nowrap;
}

.btn-random {
  background: #28a745;
  color: white;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  white-space: nowrap;
}

.btn-random:hover {
  background: #218838;
  transform: translateY(-1px);
}

.btn-random:active {
  transform: translateY(0);
}

.searching,
.no-results {
  text-align: center;
  padding: 3rem 1rem;
  font-size: 1.1rem;
  color: #666;
}

/* Email/Letter List */
.list,
.letter-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.email-card,
.letter-card {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  text-decoration: none;
  color: inherit;
  display: block;
}

.email-card:hover,
.letter-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.email-card-image {
  width: 100%;
  height: 200px;
  overflow: hidden;
  background: #e9ecef;
}

.email-card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.email-card-content,
.letter-card {
  padding: 1.5rem;
}

.email-card h2,
.letter-card h2 {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
  font-weight: 600;
}

.email-description,
.letter-card p {
  color: #666;
  margin-bottom: 0.75rem;
  line-height: 1.5;
}

.email-search-snippet {
  color: #555;
  margin-bottom: 0.75rem;
  line-height: 1.5;
  font-style: italic;
}

.search-highlight {
  background: #fff3cd;
  color: #856404;
  font-weight: 700;
  padding: 0.1rem 0.2rem;
  border-radius: 3px;
  font-style: normal;
}

.email-date,
.letter-card time {
  display: block;
  font-size: 0.875rem;
  color: #888;
}

/* Email/Letter Reader */
.email-reader,
.letter-content {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  margin-bottom: 2rem;
}

.email-reader {
  touch-action: pan-y pinch-zoom;
}

.reader-nav,
.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background: #f8f9fa;
  border-bottom: 1px solid #dee2e6;
  gap: 1rem;
  flex-wrap: wrap;
}

.reader-nav-bottom {
  border-top: 1px solid #dee2e6;
  border-bottom: none;
}

.nav-buttons,
.nav-links {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

/* Buttons */
.btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  text-decoration: none;
  display: inline-block;
}

.btn:hover {
  transform: translateY(-1px);
}

.btn:active {
  transform: translateY(0);
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-nav {
  background: #007bff;
  color: white;
}

.btn-nav:hover {
  background: #0056b3;
}

.btn-back-arrow {
  background: none;
  border: none;
  color: #333;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  transition: color 0.2s, transform 0.1s;
  line-height: 1;
}

.btn-back-arrow:hover {
  color: #007bff;
  transform: translateX(-2px);
}

.btn-back-arrow:active {
  transform: translateX(0);
}

/* Email/Letter Content */
.email-content,
.letter-content {
  padding: 2rem 1.5rem;
}

.email-header,
.letter-header {
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 2px solid #e9ecef;
}

.email-header h1,
.letter-header h1 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: #1a1a1a;
  line-height: 1.3;
}

.email-header .email-date,
.letter-header time {
  font-size: 1rem;
  color: #666;
}

/* Email/Letter Body Styles */
.email-body,
.letter-body {
  font-size: 1.0625rem;
  line-height: 1.7;
  color: #333;
}

.email-body h1,
.email-body h2,
.email-body h3,
.email-body h4,
.email-body h5,
.email-body h6,
.letter-body h1,
.letter-body h2,
.letter-body h3,
.letter-body h4,
.letter-body h5,
.letter-body h6 {
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: #1a1a1a;
  line-height: 1.3;
}

.email-body h1,
.letter-body h1 {
  font-size: 1.875rem;
}

.email-body h2,
.letter-body h2 {
  font-size: 1.5rem;
}

.email-body h3,
.letter-body h3 {
  font-size: 1.25rem;
}

.email-body p,
.letter-body p {
  margin-bottom: 1rem;
}

.email-body a,
.letter-body a {
  color: #007bff;
  text-decoration: none;
}

.email-body a:hover,
.letter-body a:hover {
  text-decoration: underline;
}

.email-body img,
.letter-body img {
  max-width: 100%;
  height: auto;
  border-radius: 4px;
  margin: 1.5rem 0;
}

.email-body ul,
.email-body ol,
.letter-body ul,
.letter-body ol {
  margin-bottom: 1rem;
  padding-left: 2rem;
}

.email-body li,
.letter-body li {
  margin-bottom: 0.5rem;
}

.email-body blockquote,
.letter-body blockquote {
  margin: 1.5rem 0;
  padding-left: 1rem;
  border-left: 4px solid #e9ecef;
  color: #666;
  font-style: italic;
}

.email-body code,
.letter-body code {
  background: #f8f9fa;
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  font-family: 'Courier New', monospace;
  font-size: 0.9em;
}

.email-body pre,
.letter-body pre {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto;
  margin: 1.5rem 0;
}

.email-body pre code,
.letter-body pre code {
  background: none;
  padding: 0;
}

.email-body hr,
.letter-body hr {
  border: none;
  border-top: 2px solid #e9ecef;
  margin: 2rem 0;
}

/* PWA Banner */
.pwa-banner {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.pwa-banner-text {
  flex: 1;
  min-width: 200px;
}

.pwa-banner-text h3 {
  margin-bottom: 0.25rem;
  font-size: 1.1rem;
}

.pwa-banner-text p {
  font-size: 0.9rem;
  opacity: 0.9;
}

.btn-primary {
  background: #007bff;
  color: white;
  padding: 0.75rem 1.25rem;
  border: none;
  border-radius: 6px;
  font-size: 0.9375rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-primary:hover {
  background: #0056b3;
  transform: translateY(-1px);
}

.btn-primary:active {
  transform: translateY(0);
}

.btn-primary:disabled {
  background: #6c757d;
  cursor: not-allowed;
  transform: none;
}

.btn-danger {
  background: #dc3545;
  color: white;
  padding: 0.75rem 1.25rem;
  border: none;
  border-radius: 6px;
  font-size: 0.9375rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-danger:hover {
  background: #c82333;
  transform: translateY(-1px);
}

.btn-danger:active {
  transform: translateY(0);
}

/* Offline & PWA UI */
.offline-banner {
  background: #ff9800;
  color: white;
  padding: 0.75rem 1rem;
  text-align: center;
  border-radius: 8px;
  margin-bottom: 1rem;
  font-weight: 500;
}

.download-progress {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.download-progress-bar {
  height: 8px;
  background: #e9ecef;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.download-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #007bff, #0056b3);
  transition: width 0.3s ease;
}

.download-progress p {
  font-size: 0.875rem;
  color: #666;
  text-align: center;
  margin: 0;
}

.btn-offline {
  background: #6c757d;
  color: white;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  white-space: nowrap;
}

.btn-offline:hover {
  background: #5a6268;
  transform: translateY(-1px);
}

.btn-offline:active {
  transform: translateY(0);
}

.offline-panel {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.offline-panel h3 {
  margin-bottom: 1rem;
  color: #1a1a1a;
  font-size: 1.25rem;
}

.offline-stats {
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 6px;
  margin-bottom: 1rem;
}

.offline-stats p {
  margin: 0.5rem 0;
  color: #495057;
  font-size: 0.9375rem;
}

.offline-actions {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.offline-note {
  font-size: 0.875rem;
  color: #666;
  line-height: 1.5;
  margin: 0;
  font-style: italic;
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    padding: 1rem 0.5rem;
  }

  .header h1 {
    font-size: 2rem;
  }

  .control-row {
    flex-direction: column;
    align-items: stretch;
  }

  .sort-container {
    width: 100%;
    justify-content: space-between;
  }

  .sort-select {
    flex: 1;
  }

  .result-count {
    text-align: center;
  }

  .btn-random {
    width: 100%;
  }

  .email-card-content {
    padding: 1rem;
  }

  .email-card h2 {
    font-size: 1.25rem;
  }

  .email-content,
  .letter-content {
    padding: 1.5rem 1rem;
  }

  .email-header h1,
  .letter-header h1 {
    font-size: 1.5rem;
  }

  .reader-nav,
  .navigation {
    flex-direction: column;
    align-items: stretch;
  }

  .nav-buttons,
  .nav-links {
    flex-direction: column;
  }

  .btn {
    width: 100%;
    text-align: center;
  }

  .btn-nav {
    font-size: 0.8125rem;
    white-space: normal;
    word-wrap: break-word;
  }

  body {
    padding: 10px;
  }

  .pwa-banner {
    flex-direction: column;
    text-align: center;
  }
}

@media (max-width: 480px) {
  .email-card-image {
    height: 150px;
  }

  .email-body,
  .letter-body {
    font-size: 1rem;
  }
}


    
    /* Static site specific adjustments */
    body {
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    
    <div class="pwa-banner" style="display: none;">
      <div class="pwa-banner-text">
        <h3>üì± Read Offline</h3>
        <p>Install the app to read all letters offline</p>
      </div>
      <div>
        <button class="btn btn-primary" onclick="installPWA()">Install App</button>
      </div>
    </div>

    <article class="letter-content">
      <header class="letter-header">
        <h1>5/24/17</h1>
        <time datetime="2017-05-24T00:00:00Z">May 23, 2017</time>
      </header>

      <div class="letter-body">
        <p>i&#39;m thankful that we have gotten through the first day of dog sitting, which was difficult and tiring. i&#39;m thankful to feel more tired than i have felt in a long time and to have had real trouble waking up this morning, which is almost never the case with me. i&#39;m thankful to d, who got up early this morning to let him out to pee and who is now taking him on a walk before it starts raining, which it&#39;s supposed to do. i&#39;m thankful to look back at this letter i wrote on father&#39;s day in 2012, the first time that d and i dog sat together:</p>
<p>&quot;<em>I hate this dog.¬† There is your status report, on what I hope to God is the final full day of me having to help take care of this dog ¬†I hate what it means about me that I hate this dog, what it says about me as a person that I hate an animal, but I have tried and tried and tried to give this dog love and I have received, on occasions, glimmers of it in return, but mostly the dog keeps shitting on that love (often literally, more often figuratively) and I don&#39;t feel like I have much more to give it.¬† I have always loved dogs more than any other animals in the world and seeing a dog on my jog or in the park or downtown on a leash has always made me a little bit happy (and if I get to pet it, a lot happy) and now I kind of feel like I would be fine if I never saw another dog in my life.¬† That is probably obviously hyperbole, but that is the way I feel right now, hyperbolic.¬† Even my dog at home, who is so much better in every way than this dog and who I love deeply and without reservation; right now, I can feel nothing inside me tugging when I imagine her image, whereas before I always felt a great deal of warm stuff.¬† That is the depth of the hatred I am radiating right now; it erases that inner warmth that I have carried inside me since I was a child and one day there was a puppy in the backseat of my mom&#39;s car when she picked me up from elementary school.</em></p>
<p><em>Maybe the fact that I have not gotten any of the work that I wanted to get done this weekend because the dog makes it impossible to concentrate and the fact that I have been up since before 6 this morning and have been averaging 4-5 hrs sleep every night and the fact that even those 4-5 hours are rung through with barks, maybe all those facts and their effect on my mental health are amplifying this feeling into something irrational and extreme, something that does not accurately represent my true feelings, but whatever, I am not going to simply rationalize this away, I hate this dog.¬† For the rest of the time that this dog is in my charge, I will of course continue to treat this dog as patiently and warmly and humanely as is humanly possible for me to do, but my annoyance with the dog has calcified into a hatred in my heart and I do not know how to make it go away, even though I think hatred is the most negative emotion and one of the ways I try live my life in a productive way every day is by trying to break down, neutralize, and resolve negative emotions. ¬† It makes me feel better to write this down for you, it does make me feel some distance from it, by putting it into sentences, but it doesn&#39;t make my hatred go away; it is still inside me.¬† I guess there are limits to the power of writing.</em></p>
<p><em>I told my girlfriend this morning when she came downstairs yawning at 7:30 that I understood why people&#39;s marriages broke up when they had children.¬† I said that and stared at her with barely concealed rage as I laid on the floor rubbing the belly of the dog and trying to keep him from biting me because that is the only thing that I had found in the hour and half I had been up that would keep him from barking and I needed him to stop barking.¬† I didn&#39;t think about it at the time, all I could think about was my anger and my unhappiness, but now that she has been able to quiet the dog down somewhat (she is much better at it than me) and I have been able to quiet the rage in my brain some, I can see how this is a motif, a repetition of Friday evening around sunset, when, in the middle of us fooling around on the couch, the dog took a shit on the kitchen floor.¬† When we noticed it had happened (it didn&#39;t take long; the smell was pretty hard to miss), I said to her that I finally understood why people stopped having sex when they had kids.¬† I said that but then I laughed and she laughed and we picked up the shit and lit some scented candles and washed our hands thoroughly several times and then had some really very good sex in the guest bed upstairs.¬† I laughed when I said that, about marriage, because while it did have the feeling of some kind of learned truth, it was also a joke.</em> ¬†</p>
<p><em>This morning, my comment about couples was not a joke and there was no laughing.¬† Another thing I said to my girlfriend when she came downstairs this morning was that another reason I hated the dog was because it was making me feel hatred toward her, who I love very much and who I know I have no logical reason to feel hatred toward.¬† Not that it&#39;s really logical to hate a dog, who is not capable of the kind of intentional thinking or moral code that could allow for the possibility of &quot;good&quot; and &quot;bad&quot; (however much we use those terms) either, but I really have no reason to feel hatred toward her, who does not shit on the floor or scratch me and is just trying to make the best of a situation that is difficult and unpleasant for her too.¬† Yet I was feeling it, though maybe a word that is better for what I was feeling than hatred is resentment or bitterness or anger.¬† I guess those feelings arose from discipline and our different ways of handling it; while we are roughly following the rules and guidelines set down (and apparently put in place, though not really, it seems to me) by the dog&#39;s parents, we have, especially in the past day or so, argued about to what extent we can put those rules in place (how much time can the dog stay in his crate, when should he be given a treat, how to deal with him biting/barking/trying to break out of his gated place).¬† My girlfriend has gravitated toward a softer, more empathetic approach and I have gravitated toward a somewhat more punitive approach (while of course I have not and would not ever do anything to hurt the dog, because that is wrong).</em> ¬†</p>
<p><em>We have argued about these approaches, these differences, and this morning, describing how I was feeling towards her, I said that it felt like the things she was saying about how the dog should be treated were also judgments of me, that it seemed like her counterarguments about his treatment (and the way she was looking at me when I advanced my arguments) were also implicit statements that I was not a good person.¬† She said, after a pause, that she thought it was just that I was more &quot;...impatient&quot; than her and that also maybe my intensity of my frustration and negative feelings toward the dog made it more possible for her to play the opposite role and that is a very logical way to understand the situation but I just know how I felt in that pause after I said it seemed like she didn&#39;t think I was a good person and she hadn&#39;t yet responded, that pause, and how that feeling then swelled inside me when her eventual response on the other end of the silence wasn&#39;t to immediately reassure me that she believed I was good.¬† I remember how right then I felt like we were characters in a literary short story having the kind of epiphanic moment where they learn the real deep truth about each other and the implications for the future of their relationship, which, since it is a literary short story, are not explicit but vague and ominous and hard to understand.¬† Maybe it was really that kind of literary life changing moment and maybe I just decided that because I&#39;m trying to write about it and we will have both forgotten it within a week back home together and I guess in the future maybe we&#39;ll see.</em></p>
<p><em>It is not the future now, of course, except in the way that every next second is the future becoming the present, but it is Father&#39;s Day and maybe this is unpleasant and doesn&#39;t paint a very good picture of me (as if the rest of this email does) but at this point in the dog-sitting weekend it is hard for me to imagine ever wanting to have a child.¬† I just can&#39;t (my girlfriend was just emailing with J.K., who said that she can&#39;t imagine even having a hamster right now; I think I could handle a hamster, though I don&#39;t want one).¬† I know that dogs are not children and in fact my mother told me the other day on the phone, in response to my complaints about this dog&#39;s behavior, that they had very strongly considered returning our first dog to the pound soon after bringing her home because of similar behavior, and of course they did not do that with me or my brother (and, ultimately did not do that with the dog either).¬† Still, I just can&#39;t imagine being able to put aside all the things that are important in my life right now to care for this little thing which maybe if you&#39;re lucky will be able to return some small fraction of the love and time that you give it.¬† From my perspective sitting here at the coffee table and looking over at this damned annoying dog, who thank God is sleeping, I just do not understand that.¬† I do not understand how people can be so selfless and good to do that, and I feel deeply grateful to my mother and, especially today, to my father for giving me a good life, even though I&#39;m sure there were many many times when that life was not fun or pleasant or exactly how he wanted it to be.¬† This year, as a way of attempting to show my gratitude for the gifts of life and love, I have bought him an iPad stylus and a specially shaped knife for scraping peanut butter out of jars.¬† This is an adequate response, right</em>?&quot;</p>
<p>i&#39;m thankful that this dog, while severely trying my patience and making it difficult for me to feel gratitude, is less annoying than that dog and i&#39;m thankful to read about my past frustration as a way of reminding myself that i got through that and will get through this. i&#39;m thankful that so far the dog has not had any accidents in the house. i&#39;m thankful that he doesn&#39;t howl and yelp as frequently or as loudly as the that dog. i&#39;m thankful that though he is incredibly bitey, his bites don&#39;t usually break the skin. i&#39;m thankful for his fluffy hair, even if it is all over everything. i&#39;m thankful for his happiness when i pay attention to him.¬†i&#39;m thankful that we have gotten through the first day of dog sitting</p>

      </div>
    </article>

    <nav class="navigation">
      <a href="/letters/" class="btn btn-secondary">home</a>
      <div class="nav-links">
        <a href="/letters/letters/52517.html" class="btn btn-secondary">‚Üê 5/25/17</a>
        <a href="/letters/letters/52317.html" class="btn btn-secondary">5/23/17 ‚Üí</a>
      </div>
    </nav>
  
  </div>

  <script>
    // PWA installation prompt
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      const banner = document.querySelector('.pwa-banner');
      if (banner) {
        banner.style.display = 'flex';
      }
    });

    async function installPWA() {
      if (!deferredPrompt) {
        // If not installable, redirect to PWA
        window.location.href = '/letters/app/';
        return;
      }

      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        console.log('PWA installed');
      }
      
      deferredPrompt = null;
      const banner = document.querySelector('.pwa-banner');
      if (banner) {
        banner.style.display = 'none';
      }
    }

    function openPWA() {
      window.location.href = '/letters/app/';
    }

    // Progressive Enhancement: Check if user has PWA installed
    // If they do, redirect them to the app version for a richer experience
    if (window.matchMedia('(display-mode: standalone)').matches) {
      // User is in standalone mode (PWA is installed and running)
      // Keep them on static page - they're already in PWA mode
      console.log('Running in PWA mode');
    } else {
      // Check if user has previously used the PWA (has cached data)
      if ('caches' in window) {
        caches.keys().then(cacheNames => {
          const hasPWACache = cacheNames.some(name => 
            name.includes('static-') || name.includes('data-')
          );
          
          // Only show PWA banner if they have cached content
          if (hasPWACache) {
            const banner = document.querySelector('.pwa-banner');
            if (banner && banner.style.display === 'none') {
              banner.style.display = 'flex';
            }
          }
        });
      }
    }

    // Register service worker for all pages
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('/letters/sw.js', { scope: '/letters/' })
          .then((registration) => {
            console.log('SW registered:', registration);
          })
          .catch((error) => {
            console.log('SW registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>